# WebDAV 备份与恢复功能

## 1. 功能概述

WebDAV 备份与恢复功能允许您将 Prompt Optimizer 应用数据的完整备份保存到远程 WebDAV 服务器，并在之后进行恢复。此功能非常适用于以下场景：

*   在浏览器出现问题或数据丢失时保护您的数据安全。
*   在不同浏览器或计算机之间迁移您的数据。
*   手动管理您的应用数据版本。

备份内容包括您所有的提示、历史记录、设置以及其他应用特定数据。

## 2. 访问此功能

您可以从应用内的 **数据管理 (Data Management)** 视图访问 WebDAV 备份与恢复设置。导航到此部分以配置您的 WebDAV 服务器并执行备份或恢复操作。

## 3. 配置 WebDAV 设置

在使用备份和恢复功能之前，您需要配置 WebDAV 服务器的连接详细信息。

以下是可用的字段：

*   **服务器 URL (Server URL):**
    *   **说明:** 指向您的 WebDAV 服务器上用于存储备份的目录的完整 URL。此 URL 通常指向 WebDAV 服务器上特定用户的文件区域。
    *   **示例:** `https://your-webdav-server.com/remote.php/dav/files/username/` 或 `https://mydomain.com/webdav/`
    *   **注意:** 请确保 URL 以 `http://` 或 `https://` 开头。

*   **用户名 (Username):**
    *   **说明:** 向您的 WebDAV 服务器进行身份验证所需的用户名。

*   **密码 (Password):**
    *   **说明:** 指定 WebDAV 用户名的密码。

*   **远程备份路径 (Remote Backup Path) (可选):**
    *   **说明:** 这是一个*相对于您服务器 URL 根目录*的路径，备份文件将存储在此处。您可以将其视为 WebDAV 服务器上的一个子文件夹。如果将此字段留空，备份文件将保存在由服务器 URL 指定的主目录中。
    *   实际的备份文件将始终命名为 `prompt_optimizer_backup.json`。
    *   **示例:**
        *   如果您输入 `my_backups/app_data`，备份将保存为 `[服务器 URL]/my_backups/app_data/prompt_optimizer_backup.json`。
        *   如果留空，备份将保存为 `[服务器 URL]/prompt_optimizer_backup.json`。
    *   **注意:** 路径的开头或结尾不应包含斜杠 (`/`)。请使用 `folder/subfolder` 格式。

**如何保存设置:**
填写完必要的详细信息后，点击“保存设置”按钮。应用程序会将这些设置安全地存储在您浏览器的本地存储中。您将收到反馈，告知设置是否已成功保存。

## 4. 执行备份

配置并保存 WebDAV 设置后：

*   **如何启动备份:** 在数据管理视图的“备份与恢复”部分中，点击“备份到 WebDAV”按钮。
*   **备份期间会发生什么:**
    1.  应用程序收集您的所有数据（提示、历史记录、设置等）。
    2.  此数据被序列化为 JSON 格式。
    3.  应用程序使用保存的设置连接到您的 WebDAV 服务器。
    4.  JSON 数据作为名为 `prompt_optimizer_backup.json` 的文件上传到指定的“远程备份路径”。如果已存在同名文件，它将被覆盖。
*   **成功/失败反馈:**
    *   在此过程中，您将看到诸如“正在备份...”之类的状态消息。
    *   完成后，一条消息将指示备份是否成功或是否发生错误。常见错误包括连接问题、身份验证失败或向服务器写入文件时出现问题。

## 5. 执行恢复

恢复数据允许您用先前保存的备份替换当前的应用数据。

*   **如何启动恢复:** 在“备份与恢复”部分中点击“从 WebDAV 恢复”按钮。
*   **确认步骤:**
    *   **重要提示:** 在恢复过程开始之前，系统会要求您确认操作。恢复数据将**完全覆盖您当前所有的应用数据**。此操作无法撤销。
    *   在继续之前，请仔细考虑。
*   **恢复期间会发生什么:**
    1.  应用程序使用保存的设置连接到您的 WebDAV 服务器。
    2.  它尝试从指定的“远程备份路径”下载 `prompt_optimizer_backup.json` 文件。
    3.  如果下载成功，您现有的所有本地应用数据都将被清除。
    4.  然后，备份文件中的数据将导入到应用程序中。
*   **成功/失败反馈:**
    *   在此过程中，您将看到诸如“正在恢复...”之类的状态消息。
    *   完成后，一条消息将指示恢复是否成功或是否发生错误。常见错误包括无法连接到服务器、未找到备份文件或备份文件格式存在问题。

## 6. 重要说明与故障排除

*   **服务器配置:** 确保您的 WebDAV 服务器配置正确、正在运行，并且可以从您浏览器所在的网络访问。防火墙或网络代理可能会干扰连接。
*   **数据覆盖警告:** 恢复数据对您当前的本地数据是一项破坏性操作。请始终确保您希望用备份内容替换当前数据。如果您有任何疑问，在从 WebDAV 恢复之前，请考虑进行本地备份（如果应用程序支持其他导出方法）。
*   **备份文件名:** 存储在您 WebDAV 服务器上的备份文件始终命名为 `prompt_optimizer_backup.json`。它将位于您指定的“远程备份路径”内，如果远程路径为空，则位于“服务器 URL”的根目录下。
*   **常见错误消息:**
    *   **“WebDAV settings not configured...” (WebDAV 设置未配置...)**: 请转到“WebDAV 配置”部分并保存您的服务器详细信息。
    *   **“Connection Error...” (连接错误...)**: 无法访问 WebDAV 服务器。请检查您的服务器 URL、互联网连接以及服务器是否在线。
    *   **“Authentication Failed...” (身份验证失败...)**: 用户名或密码无效。请在 WebDAV 设置中验证您的凭据。
    *   **“File Not Found...” (文件未找到...)**: 在恢复尝试期间，无法在服务器上的指定远程路径中找到 `prompt_optimizer_backup.json` 文件。请检查“远程备份路径”设置，并确保备份文件存在。
    *   **“Access Forbidden...” (访问被禁止...)**: 您的 WebDAV 用户没有权限读取或写入指定路径。请检查您 WebDAV 服务器上的权限。
    *   **“Insufficient Storage...” (存储空间不足...)**: WebDAV 服务器可能没有足够的空间来保存您的备份。
    *   **“Invalid Path...” (路径无效...)**: “远程备份路径”可能包含无效字符或结构不正确。
    *   **“Failed to parse backup data...” (解析备份数据失败...)**: 下载的备份文件可能已损坏或不是预期的 JSON 格式。
*   **开发者控制台:** 如果遇到持续存在的问题，并且 UI 中提供的错误消息不够具体，请打开浏览器的开发者控制台（通常按 F12）。那里可能会提供更详细的错误信息或网络请求日志，这有助于诊断问题。

遵循这些指南，您应该能够有效地使用 WebDAV 备份和恢复功能来管理您的 Prompt Optimizer 数据。
